---
import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import ProjectsLayout from '../layouts/Projects.astro';

const projects = await getCollection('projects', ({ data }: CollectionEntry<'projects'>) => {
  return import.meta.env.PROD ? !data.draft : true;
});

// Sort projects by order if available, then by title
const sortedProjects = projects.sort(
  (a: CollectionEntry<'projects'>, b: CollectionEntry<'projects'>) => {
    if (a.data.order && b.data.order) {
      return a.data.order - b.data.order;
    }
    return a.data.title.localeCompare(b.data.title);
  }
);
---

<Layout title="Projects | Mission Mike" description="Projects by Mission Mike">
  <main class="min-h-screen">
    <div class="py-8 sm:py-12">
      <div class="container mx-auto px-4">
        <h1 class="text-4xl sm:text-5xl font-bold text-center mb-12">Projects</h1>
        <ProjectsLayout projects={sortedProjects} />
      </div>
    </div>
  </main>
</Layout>
